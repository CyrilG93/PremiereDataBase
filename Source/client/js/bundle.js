/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={3(e){e.exports=require("path")},383(e){e.exports=require("fs")},863(e,t,n){n.d(t,{A:()=>a});const r=require("events");e=n.hmd(e);class o extends r.EventEmitter{constructor(e,t,n){if(super(),this.pluginName=e,this.pluginID=t,this._commands=n||[],this._commandListener=null,!this.pluginName||!this.pluginID)throw new Error("pluginName && pluginID required");this._addEventListener("knights_of_the_editing_table.spellbook.app.opened",()=>this.register(this._commands)),this.start()}register(e){if(!this.pluginName||!e)throw new Error("pluginName && commands required");{this._commands=e;const t={pluginID:this.pluginID,name:this.pluginName,commands:e};this._dispatchEvent("knights_of_the_editing_table.spellbook.api.commands.add",t)}}start(){const e=`knights_of_the_editing_table.spellbook.api.${this.pluginID}.command.registered`;this._commandListener=e=>{const t=e.data,n=this._find(t);n&&("function"==typeof n.action&&n.action(),this.emit(t,t))},this._addEventListener(e,this._commandListener)}stop(){const e=`knights_of_the_editing_table.spellbook.api.${this.pluginID}.command.registered`;this._commandListener&&(this._removeEventListener(e,this._commandListener),this._commandListener=null)}_find(e){return this._commands&&this._commands.find(t=>t.commandID===e)}_addEventListener(e,t){"undefined"!=typeof window&&window.__adobe_cep__&&window.__adobe_cep__.addEventListener(e,t)}_removeEventListener(e,t){"undefined"!=typeof window&&window.__adobe_cep__&&window.__adobe_cep__.removeEventListener(e,t)}_dispatchEvent(e,t){"undefined"!=typeof window&&window.__adobe_cep__&&window.__adobe_cep__.dispatchEvent({type:e,scope:"APPLICATION",appId:JSON.parse(window.__adobe_cep__.getHostEnvironment()).appId,extensionId:window.__adobe_cep__.getExtensionId(),data:JSON.stringify(t)})}}const a=o;e.exports=o}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r](a,a.exports,n),a.loaded=!0,a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const r=n(863).A;function o(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t,n){return(t=function(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var l=r&&r.prototype instanceof s?r:s,d=Object.create(l.prototype);return c(d,"_invoke",function(n,r,o){var a,s,l,c=0,d=o||[],u=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,s=0,l=e,f.n=n,i}};function m(n,r){for(s=n,l=r,t=0;!u&&c&&!o&&t<d.length;t++){var o,a=d[t],m=f.p,p=a[2];n>3?(o=p===r)&&(l=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=n<2&&m<a[1])?(s=0,f.v=r,f.n=a[1]):m<p&&(o=n<3||a[0]>r||r>p)&&(a[4]=n,a[5]=r,f.n=p,s=0))}if(o||n>1)return i;throw u=!0,r}return function(o,d,p){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,p),s=d,l=p;(t=s<2?e:l)||!u;){a||(s?s<3?(s>1&&(f.n=-1),m(s,l)):f.n=l:f.v=l);try{if(c=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(u=f.n<0)?l:n.call(r,f))!==i)break}catch(t){a=e,s=1,l=t}finally{c=1}}return{value:t,done:u}}}(n,o,a),!0),d}var i={};function s(){}function d(){}function u(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(c(t={},r,function(){return this}),t),m=u.prototype=s.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,c(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e}return d.prototype=u,c(m,"constructor",u),c(u,"constructor",d),d.displayName="GeneratorFunction",c(u,o,"GeneratorFunction"),c(m),c(m,o,"Generator"),c(m,r,function(){return this}),c(m,"toString",function(){return"[object Generator]"}),(l=function(){return{w:a,m:p}})()}function c(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,t,n,r){function a(t,n){c(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},c(e,t,n,r)}function d(e,t,n,r,o,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){d(a,r,o,i,s,"next",e)}function s(e){d(a,r,o,i,s,"throw",e)}i(void 0)})}}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function m(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=p(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function p(e,t){if(e){if("string"==typeof e)return g(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var v=new CSInterface;v.addEventListener("com.database.premiere.open",function(e){v.requestOpenExtension("com.database.premiere.panel","")}),new r("Data Base","com.database.premiere.panel",[{commandID:"com.database.premiere.showPanel",name:"Show Database Panel",group:"Panel",action:function(){v.requestOpenExtension("com.database.premiere.panel","")}},{commandID:"com.database.premiere.refresh",name:"Refresh Database",group:"Actions",action:function(){Y(),J(D("status.scanning"),"info")}},{commandID:"com.database.premiere.addToDb",name:"Add Selection to Database",group:"Actions",action:function(){M()}}]).init();var h={en:{labels:{database:"Database:",notConfigured:"Not configured",files:"files",selected:"selected"},search:{placeholder:"Search files..."},filters:{all:"All",video:"Video",audio:"Audio",image:"Image"},buttons:{import:"Import",save:"Save",cancel:"Cancel",create:"Create",addToDb:"Add to DB"},settings:{title:"Settings",databasePath:"Database Path",databasePathPlaceholder:"Select database folder...",language:"Language",consolidateOnImport:"Copy files to project folder on import",consolidateDescription:"When enabled, files will be copied to the project folder before importing, preserving the folder structure.",bannedExtensions:"Excluded file extensions",bannedExtensionsPlaceholder:"e.g.: .txt, .pdf, .zip (one per line)",excludedFolders:"Excluded folder names",excludedFoldersPlaceholder:"e.g.: node_modules, .git (one per line)",consolidationDepth:"Consolidation folder depth",consolidationDepthHint:"0 = project file folder, 1 = one folder up, etc.",flattenImportPath:"Import to root folder only",flattenImportPathDescription:"When enabled, files are imported into the first-level folder only (e.g., ELEMENTS/IMAGES/file.png ‚Üí ELEMENTS bin)."},empty:{configureDatabase:"Configure your database path in settings",noFilesFound:"No files found",noFavorites:"No favorites yet"},modal:{newFolder:"New Folder",folderNamePlaceholder:"Folder name",deleteConfirm:"Are you sure you want to delete this?"},context:{addFavorite:"Add to favorites",removeFavorite:"Remove from favorites",openFolder:"Open in Finder",importFolder:"Import Folder",delete:"Delete"},status:{loading:"Loading...",scanning:"Scanning database...",importing:"Importing files...",importSuccess:"files imported successfully",importError:"Import failed",saved:"Settings saved",folderCreated:"Folder created",folderDeleted:"Folder deleted",copied:"Copied to clipboard"}},fr:{labels:{database:"Base de donn√©es :",notConfigured:"Non configur√©",files:"fichiers",selected:"s√©lectionn√©(s)"},search:{placeholder:"Rechercher des fichiers..."},filters:{all:"Tous",video:"Vid√©o",audio:"Audio",image:"Image"},buttons:{import:"Importer",save:"Enregistrer",cancel:"Annuler",create:"Cr√©er",addToDb:"Ajouter √† la base"},settings:{title:"Param√®tres",databasePath:"Chemin de la base de donn√©es",databasePathPlaceholder:"S√©lectionner le dossier...",language:"Langue",consolidateOnImport:"Copier les fichiers dans le dossier projet lors de l'import",consolidateDescription:"Lorsque cette option est activ√©e, les fichiers seront copi√©s dans le dossier du projet avant l'import, en pr√©servant la structure des dossiers.",bannedExtensions:"Extensions de fichiers exclues",bannedExtensionsPlaceholder:"ex: .txt, .pdf, .zip (une par ligne)",excludedFolders:"Noms de dossiers exclus",excludedFoldersPlaceholder:"ex: node_modules, .git (un par ligne)",consolidationDepth:"Profondeur du dossier de consolidation",consolidationDepthHint:"0 = dossier du projet, 1 = un dossier au-dessus, etc.",flattenImportPath:"Importer dans le dossier racine uniquement",flattenImportPathDescription:"Lorsque cette option est activ√©e, les fichiers sont import√©s uniquement dans le dossier de premier niveau (ex: ELEMENTS/IMAGES/fichier.png ‚Üí bin ELEMENTS)."},empty:{configureDatabase:"Configurez le chemin de la base de donn√©es dans les param√®tres",noFilesFound:"Aucun fichier trouv√©",noFavorites:"Aucun favori"},modal:{newFolder:"Nouveau dossier",folderNamePlaceholder:"Nom du dossier",deleteConfirm:"√ätes-vous s√ªr de vouloir supprimer ceci ?"},context:{addFavorite:"Ajouter aux favoris",removeFavorite:"Retirer des favoris",openFolder:"Ouvrir dans le Finder",importFolder:"Importer le dossier",delete:"Supprimer"},status:{loading:"Chargement...",scanning:"Analyse de la base de donn√©es...",importing:"Import des fichiers...",importSuccess:"fichiers import√©s avec succ√®s",importError:"√âchec de l'import",saved:"Param√®tres enregistr√©s",folderCreated:"Dossier cr√©√©",folderDeleted:"Dossier supprim√©",copied:"Copi√© dans le presse-papiers"}}},y="en",b={databasePath:"",language:"en",itemSize:0,consolidateOnImport:!1,consolidationDepth:0,flattenImportPath:!1,bannedExtensions:[".txt",".pdf",".zip",".rar",".exe",".doc",".docx",".prproj"],excludedFolderNames:[".git","node_modules","__MACOSX","Adobe Premiere Pro Auto-Save"]},E=[],w=[],I=[],x=new Set,P=new Set,B="",S="list",k=["all"],L=!1,_="",F=null,O=null,C=null,A=new Set;function D(e){var t,n=e.split("."),r=h[y],o=m(n);try{for(o.s();!(t=o.n()).done;){var a=t.value;if(!r||"object"!==f(r)||!(a in r)){r=h.en;var i,s=m(n);try{for(s.s();!(i=s.n()).done;){var l=i.value;if(!r||"object"!==f(r)||!(l in r))return e;r=r[l]}}catch(e){s.e(e)}finally{s.f()}break}r=r[a]}}catch(e){o.e(e)}finally{o.f()}return r}function j(){document.querySelectorAll("[data-i18n]").forEach(function(e){var t=D(e.getAttribute("data-i18n"));"INPUT"===e.tagName&&"button"===e.type?e.value=t:e.textContent=t}),document.querySelectorAll("[data-i18n-placeholder]").forEach(function(e){var t=e.getAttribute("data-i18n-placeholder");e.placeholder=D(t)})}function N(e){h[e]&&(y=e,b.language=e,j(),q())}function M(){b.databasePath?(V(D("status.scanning")),v.evalScript("getSelectedProjectItems()",function(){var e=u(l().m(function e(t){var n,r,o,a;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:console.log("Selected items result:",t),e.p=1,n=JSON.parse(t),e.n=3;break;case 2:return e.p=2,o=e.v,R(),J("Premiere Error: "+t,"error"),console.error("Parse error:",o,t),e.a(2);case 3:if(!n||!n.error){e.n=4;break}return R(),J("Premiere Error: "+n.error,"error"),e.a(2);case 4:if(e.p=4,n&&Array.isArray(n)&&0!==n.length){e.n=5;break}return R(),J(D("empty.noFilesFound"),"info"),e.a(2);case 5:return V(D("status.importing")),r=n.map(function(e){return{name:e.name,source:e.path,destination:b.databasePath+"/"+(e.binPath?e.binPath+"/":"")+e.name}}),e.n=6,copyFiles(r,function(e){G(e.percent,"Copying ".concat(e.current,"/").concat(e.total,"..."))});case 6:R(),J("".concat(n.length," files added to database"),"success"),Y(),e.n=8;break;case 7:e.p=7,a=e.v,R(),J("Error adding to database: "+a.message,"error"),console.error(a);case 8:return e.a(2)}},e,null,[[4,7],[1,2]])}));return function(t){return e.apply(this,arguments)}}())):J(D("empty.configureDatabase"),"error")}function T(e){var t=100+(e=parseInt(e)||0)/100*200,n=32+e/100*32;document.documentElement.style.setProperty("--grid-item-size",Math.round(t)+"px"),document.documentElement.style.setProperty("--list-icon-size",Math.round(n)+"px")}function q(){b.databasePath=document.getElementById("databasePathInput").value.trim(),b.consolidateOnImport=document.getElementById("consolidateOnImport").checked,b.consolidationDepth=parseInt(document.getElementById("consolidationDepth").value)||0,b.flattenImportPath=document.getElementById("flattenImportPath").checked;var e=document.getElementById("bannedExtensions").value;b.bannedExtensions=e.split("\n").map(function(e){return e.trim()}).filter(function(e){return""!==e}).map(function(e){return e.startsWith(".")?e:"."+e});var t=document.getElementById("excludedFolders").value;b.excludedFolderNames=t.split("\n").map(function(e){return e.trim()}).filter(function(e){return""!==e}),b.language=y,localStorage.setItem("databaseSettings",JSON.stringify(b)),H(),J(D("status.saved"),"success")}function z(){localStorage.setItem("databaseFavorites",JSON.stringify(o(P)))}function H(){var e=document.getElementById("databasePath");if(b.databasePath){var t=b.databasePath.split(/[\/\\]/);e.textContent=".../"+t.slice(-2).join("/"),e.title=b.databasePath}else e.textContent=D("labels.notConfigured"),e.title=""}function J(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=document.getElementById("statusMessage");n.textContent=e,n.className="status-message visible "+t,setTimeout(function(){n.classList.remove("visible")},4e3)}function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";document.getElementById("progressSection").classList.add("visible"),e&&(document.getElementById("progressText").textContent=e)}function R(){document.getElementById("progressSection").classList.remove("visible")}function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";document.getElementById("progressBar").style.width=e+"%",t&&(document.getElementById("progressText").textContent=t)}function W(){document.getElementById("settingsPanel").classList.add("visible"),document.getElementById("settingsOverlay").classList.add("visible")}function U(){document.getElementById("settingsPanel").classList.remove("visible"),document.getElementById("settingsOverlay").classList.remove("visible")}function $(){document.getElementById("newFolderModal").classList.add("visible"),document.getElementById("newFolderName").value="",document.getElementById("newFolderName").focus()}function X(){document.getElementById("newFolderModal").classList.remove("visible")}function Y(){if(!b.databasePath)return J(D("empty.configureDatabase"),"warning"),void W();V(D("status.scanning")),G(0);try{var e=(t=b.databasePath,n={bannedExtensions:b.bannedExtensions,excludedFolderNames:b.excludedFolderNames},"function"==typeof scanDatabase?scanDatabase(t,n):(console.error("scanDatabase function not found in imported fileOperations"),{files:[],folders:[]}));E=e.files||[],w=e.folders||[],R(),K(),ce(),console.log("Scanned: ".concat(E.length," files, ").concat(w.length," folders"))}catch(e){R(),console.error("Scan error:",e),J("Error scanning database: "+e.message,"error")}var t,n}function K(){var e=o(E);if(B&&(e=e.filter(function(e){return e.folderPath===B||e.folderPath.startsWith(B+"/")})),_){var t=_.toLowerCase();e=e.filter(function(e){return e.name.toLowerCase().includes(t)||e.folderPath.toLowerCase().includes(t)})}k.includes("all")||(e=e.filter(function(e){return k.includes(e.type)})),L&&(e=e.filter(function(e){return P.has(e.path)})),I=e,document.getElementById("fileCount").textContent=I.length,ee()}function Q(){L=!L,document.getElementById("favoritesBtn").classList.toggle("active",L),K()}function Z(){document.getElementById("searchInput").value="",_="",K()}function ee(){var e,t=document.getElementById("fileBrowser"),n=w.filter(function(e){return B?e.relativePath.substring(0,e.relativePath.lastIndexOf("/"))===B:!e.relativePath.includes("/")});if(0===(e=_?I:I.filter(function(e){if(e.folderPath===B)return!0;var t,n=m(A);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e.folderPath===r)return!0}}catch(e){n.e(e)}finally{n.f()}return!1})).length&&0===n.length){var r=D("empty.noFilesFound");return b.databasePath?L?r=D("empty.noFavorites"):_&&(r=D("empty.noFilesFound")):r=D("empty.configureDatabase"),void(t.innerHTML='\n            <div class="empty-state">\n                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"\n                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />\n                </svg>\n                <p>'.concat(r,"</p>\n            </div>\n        "))}var o='<div class="file-list">';if(_){var a,i=m(e);try{for(i.s();!(a=i.n()).done;)o+=re(a.value,!0)}catch(e){i.e(e)}finally{i.f()}}else{var s,l=m(n);try{for(l.s();!(s=l.n()).done;){var c=s.value;o+=ne(c),"list"===S&&A.has(c.relativePath)&&(o+=te(c.relativePath))}}catch(e){l.e(e)}finally{l.f()}var d,u=m(e.filter(function(e){return e.folderPath===B}));try{for(u.s();!(d=u.n()).done;)o+=re(d.value,!1)}catch(e){u.e(e)}finally{u.f()}}o+="</div>",t.innerHTML=o,document.querySelectorAll(".folder-expand").forEach(function(e){e.addEventListener("click",function(t){t.stopPropagation(),le(e.getAttribute("data-folder"))})}),document.querySelectorAll(".file-item.folder").forEach(function(e){e.addEventListener("click",function(t){if(!t.target.closest(".folder-expand")){var n=e.getAttribute("data-path");"grid"===S?se(n):le(n)}}),e.addEventListener("dblclick",function(){se(e.getAttribute("data-path"))})}),document.querySelectorAll('.file-item[data-type="file"]').forEach(function(e){e.addEventListener("click",function(t){var n;t.target.closest(".file-checkbox")||t.target.closest(".file-favorite")||(n=e.getAttribute("data-path"),x.has(n)?x.delete(n):x.add(n),oe(),ee())})}),document.querySelectorAll(".file-checkbox").forEach(function(e){e.addEventListener("change",function(t){t.stopPropagation();var n=e.closest(".file-item").getAttribute("data-path");e.checked?x.add(n):x.delete(n),oe()})}),document.querySelectorAll(".file-favorite").forEach(function(e){e.addEventListener("click",function(t){var n;t.stopPropagation(),n=e.getAttribute("data-path"),P.has(n)?P.delete(n):P.add(n),z(),ee()})}),document.querySelectorAll(".audio-play-btn").forEach(function(e){e.addEventListener("click",function(t){t.stopPropagation(),function(e,t){var n=document.getElementById("audioPlayer");if(C===e&&!n.paused)return n.pause(),n.currentTime=0,C=null,t.classList.remove("playing"),void(t.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <polygon points="5 3 19 12 5 21" fill="currentColor" />\n        </svg>');if(C){n.pause();var r=document.querySelector('.audio-play-btn[data-audio-path="'.concat(CSS.escape(C),'"]'));r&&(r.classList.remove("playing"),r.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <polygon points="5 3 19 12 5 21" fill="currentColor" />\n            </svg>')}n.src=e,n.play().then(function(){C=e,t.classList.add("playing"),t.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <rect x="6" y="4" width="4" height="16" fill="currentColor" />\n            <rect x="14" y="4" width="4" height="16" fill="currentColor" />\n        </svg>'}).catch(function(e){console.error("Audio playback error:",e),J("Cannot play this audio format","error")}),n.onended=function(){C=null,t.classList.remove("playing"),t.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <polygon points="5 3 19 12 5 21" fill="currentColor" />\n        </svg>'}}(e.getAttribute("data-audio-path"),e)})}),document.querySelectorAll(".file-item").forEach(function(e){e.addEventListener("contextmenu",function(t){t.preventDefault(),function(e,t,n){var r=document.getElementById("contextMenu"),o=document.getElementById("contextAddFavorite"),a=document.getElementById("contextRemoveFavorite"),i=document.getElementById("contextImportFolder");if("folder"===n)o.classList.add("hidden"),a.classList.add("hidden"),i.classList.remove("hidden");else{var s=P.has(t);o.classList.toggle("hidden",s),a.classList.toggle("hidden",!s),i.classList.add("hidden")}r.style.left=e.clientX+"px",r.style.top=e.clientY+"px",r.classList.add("visible"),contextMenuFile=t,r.dataset.filePath=t,r.dataset.type=n}(t,e.getAttribute("data-path"),e.getAttribute("data-type"))})})}function te(e){var t,n="",r=20*(e.split("/").length-(B?B.split("/").length:0)),o=m(w.filter(function(t){return t.relativePath.substring(0,t.relativePath.lastIndexOf("/"))===e}));try{for(o.s();!(t=o.n()).done;){var a=t.value;n+=ne(a,r),A.has(a.relativePath)&&(n+=te(a.relativePath))}}catch(e){o.e(e)}finally{o.f()}var i,s=m(I.filter(function(t){return t.folderPath===e}));try{for(s.s();!(i=s.n()).done;)n+=re(i.value,!1,r)}catch(e){s.e(e)}finally{s.f()}return n}function ne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=A.has(e.relativePath)?"‚ñº":"‚ñ∂",r="list"===S?'<span class="folder-expand" data-folder="'.concat(be(e.relativePath),'">').concat(n,"</span>"):"",o=t>0?'style="margin-left: '.concat(t,'px"'):"";return'\n        <div class="file-item folder" data-path="'.concat(be(e.relativePath),'" data-type="folder" ').concat(o,">\n            ").concat(r,'\n            <div class="file-icon">\n                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"\n                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="rgba(0,120,212,0.2)" />\n                </svg>\n            </div>\n            <div class="file-info">\n                <div class="file-name">').concat(be(e.name),"</div>\n            </div>\n        </div>\n    ")}function re(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=P.has(e.path),o=x.has(e.path),a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){if("image"===e){var n=t.replace(/'/g,"\\'");return'<div class="thumbnail-image" style="background-image: url(\''.concat(n,"')\"></div>")}if("video"===e){var r=t.split(".").pop().toLowerCase();if(["mp4","webm","mov","m4v"].includes(r))return'<video class="thumbnail-video" src="'.concat(t,'" preload="metadata" muted onmouseover="this.play()" onmouseout="this.pause();this.currentTime=0;"></video>')}}switch(e){case"video":return'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor" stroke-width="2" />\n                <polygon points="10 9 16 12 10 15" fill="currentColor" />\n            </svg>';case"audio":return'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M9 18V5l12-2v13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />\n                <circle cx="6" cy="18" r="3" stroke="currentColor" stroke-width="2" />\n                <circle cx="18" cy="16" r="3" stroke="currentColor" stroke-width="2" />\n            </svg>';case"image":return'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" />\n                <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor" />\n                <path d="M21 15l-5-5L5 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />\n            </svg>';default:return'<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" />\n                <polyline points="14 2 14 8 20 8" stroke="currentColor" stroke-width="2" />\n            </svg>'}}(e.type,e.path),i=e.folderPath||"Root";t&&(i=e.folderPath||"Root");var s=n>0?'style="margin-left: '.concat(n,'px"'):"",l="audio"===e.type?'\n        <button class="audio-play-btn" data-audio-path="'.concat(be(e.path),'" title="Play/Pause">\n            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <polygon points="5 3 19 12 5 21" fill="currentColor" />\n            </svg>\n        </button>\n    '):"";return'\n        <div class="file-item '.concat(o?"selected":"",'" data-path="').concat(be(e.path),'" data-type="file" ').concat(s,'>\n            <input type="checkbox" class="file-checkbox" ').concat(o?"checked":"",'>\n            <div class="file-icon ').concat(e.type,'">\n                ').concat(a,'\n            </div>\n            <div class="file-info">\n                <div class="file-name">').concat(be(e.name),'</div>\n                <div class="file-path">üìÅ ').concat(be(i),"</div>\n            </div>\n            ").concat(l,'\n            <button class="file-favorite ').concat(r?"active":"",'" data-path="').concat(be(e.path),'">\n                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"\n                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />\n                </svg>\n            </button>\n        </div>\n    ')}function oe(){document.getElementById("selectedCount").textContent=x.size,document.getElementById("importBtn").disabled=0===x.size}function ae(){I.forEach(function(e){return x.add(e.path)}),oe(),ee()}function ie(){x.clear(),oe(),ee()}function se(e){B=e,x.clear(),A.clear(),oe(),K(),ce()}function le(e){A.has(e)?A.delete(e):A.add(e),ee()}function ce(){var e=document.getElementById("homeBtn");e&&(e.onclick=function(){return se("")});var t=document.getElementById("backBtn");t&&(t.onclick=function(){return function(){if(B){var e=B.lastIndexOf("/");B=e>0?B.substring(0,e):"",x.clear(),oe(),K(),ce()}}()},t.disabled=!B,t.classList.toggle("disabled",!B))}function de(e){S=e;var t=document.getElementById("fileBrowser");"grid"===e?t.classList.add("grid-view"):t.classList.remove("grid-view"),document.getElementById("listViewBtn").classList.toggle("active","list"===e),document.getElementById("gridViewBtn").classList.toggle("active","grid"===e),ee()}function ue(){var e=document.getElementById("newFolderName").value.trim();if(e){var t=B?b.databasePath+"/"+B:b.databasePath,n=createDirectory(t+"/"+e);n.success?(X(),J(D("status.folderCreated"),"success"),Y()):J(n.error,"error")}}function fe(){return me.apply(this,arguments)}function me(){return(me=u(l().m(function e(){var t;return l().w(function(e){for(;;)switch(e.n){case 0:if(0!==x.size){e.n=1;break}return e.a(2);case 1:return t=E.filter(function(e){return x.has(e.path)}),e.n=2,ge(t);case 2:e.v>0&&(x.clear(),oe(),ee());case 3:return e.a(2)}},e)}))).apply(this,arguments)}function pe(){return(pe=u(l().m(function e(t){var n;return l().w(function(e){for(;;)switch(e.n){case 0:if(0!==(n=E.filter(function(e){return e.folderPath===t||e.folderPath&&e.folderPath.startsWith(t+"/")})).length){e.n=1;break}return J(D("empty.noFilesFound"),"warning"),e.a(2);case 1:return e.n=2,ge(n);case 2:return e.a(2)}},e)}))).apply(this,arguments)}function ge(e){return ve.apply(this,arguments)}function ve(){return(ve=u(l().m(function e(t){var n,r,o,a,i,s,c,d,u,f;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:if(V(D("status.importing")),G(0),e.p=1,n=t.map(function(e){var t=e.folderPath||"";if(b.flattenImportPath&&t){var n=t.split("/");t=n[0]||""}return{name:e.name,path:e.path,binPath:t}}),!b.consolidateOnImport){e.n=11;break}return r=null,e.p=2,e.n=3,he();case 3:r=e.v,e.n=5;break;case 4:e.p=4,u=e.v,console.error("Error getting project path",u);case 5:if(!r){e.n=11;break}o=r.substring(0,r.lastIndexOf("/")),a=0;case 6:if(!(a<(b.consolidationDepth||0))){e.n=9;break}if(!((i=o.lastIndexOf("/"))>0)){e.n=7;break}o=o.substring(0,i),e.n=8;break;case 7:return e.a(3,9);case 8:a++,e.n=6;break;case 9:return s=n.map(function(e){return{name:e.name,source:e.path,destination:o+"/"+(e.binPath?e.binPath+"/":"")+e.name}}),e.n=10,copyFiles(s,function(e){G(.5*e.percent,"Copying ".concat(e.current,"/").concat(e.total,"..."))});case 10:n.forEach(function(e,t){e.path=s[t].destination});case 11:return G(50,D("status.importing")),c=JSON.stringify(n),d=btoa(unescape(encodeURIComponent(c))),e.a(2,new Promise(function(e){v.evalScript("DataBase_importFilesToProjectBase64('".concat(d,"')"),function(t){R();try{var n=JSON.parse(t);if(n.error)J(D("status.importError")+": "+n.error,"error"),e(0);else{var r=n.totalImported||0;J("".concat(r," ").concat(D("status.importSuccess")),"success"),e(r)}}catch(t){J(D("status.importError"),"error"),console.error("Import error:",t),e(0)}})}));case 12:return e.p=12,f=e.v,R(),J(D("status.importError"),"error"),console.error("Import failed:",f),e.a(2,0)}},e,null,[[2,4],[1,12]])}))).apply(this,arguments)}function he(){return new Promise(function(e){v.evalScript("DataBase_getProjectPath()",function(t){e("null"===t?null:t)})})}function ye(){document.getElementById("contextMenu").classList.remove("visible")}function be(e){if(!e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}function Ee(){v.evalScript("DataBase_selectFolder()",function(e){e&&"null"!==e&&(document.getElementById("databasePathInput").value=e)})}document.addEventListener("DOMContentLoaded",function(){!function(){var e=localStorage.getItem("databaseSettings");if(e)try{var t=JSON.parse(e);b=i(i({},b),t),y=b.language||"en"}catch(e){console.error("Error loading settings:",e)}var n=localStorage.getItem("databaseFavorites");if(n)try{P=new Set(JSON.parse(n))}catch(e){console.error("Error loading favorites:",e)}document.getElementById("databasePathInput").value=b.databasePath||"",document.getElementById("consolidateOnImport").checked=b.consolidateOnImport||!1,document.getElementById("consolidationDepth").value=b.consolidationDepth||0,document.getElementById("flattenImportPath").checked=b.flattenImportPath||!1,document.getElementById("bannedExtensions").value=(b.bannedExtensions||[]).join("\n"),document.getElementById("excludedFolders").value=(b.excludedFolderNames||[]).join("\n"),document.getElementById("languageSelect").value=y,document.getElementById("settingsLanguageSelect").value=y,H(),j(),void 0!==b.itemSize&&(document.getElementById("sizeSlider").value=b.itemSize,T(b.itemSize))}(),setTimeout(initSpellBook,1e3),document.getElementById("settingsBtn").addEventListener("click",W),document.getElementById("closeSettingsBtn").addEventListener("click",U),document.getElementById("settingsOverlay").addEventListener("click",U),document.getElementById("saveSettingsBtn").addEventListener("click",function(){q(),U(),Y()}),document.getElementById("browseDatabaseBtn").addEventListener("click",Ee),document.getElementById("languageSelect").addEventListener("change",function(e){N(e.target.value),document.getElementById("settingsLanguageSelect").value=e.target.value}),document.getElementById("settingsLanguageSelect").addEventListener("change",function(e){N(e.target.value),document.getElementById("languageSelect").value=e.target.value}),document.getElementById("searchInput").addEventListener("input",function(e){var t;t=e.target.value,_=t,F&&clearTimeout(F),F=setTimeout(function(){K()},300)}),document.getElementById("clearSearch").addEventListener("click",Z),document.getElementById("favoritesBtn").addEventListener("click",Q),document.querySelectorAll(".type-filter-btn").forEach(function(e){e.addEventListener("click",function(){var t;"all"===(t=e.getAttribute("data-type"))?k=["all"]:k.includes("all")?k=[t]:k.includes(t)?(k=k.filter(function(e){return e!==t}),0===k.length&&(k=["all"])):k.push(t),document.querySelectorAll(".type-filter-btn").forEach(function(e){var t=e.getAttribute("data-type");e.classList.toggle("active",k.includes(t))}),K()})}),document.getElementById("listViewBtn").addEventListener("click",function(){return de("list")}),document.getElementById("gridViewBtn").addEventListener("click",function(){return de("grid")}),document.getElementById("sizeSlider").addEventListener("input",function(e){var t=e.target.value;b.itemSize=t,T(t),clearTimeout(O),O=setTimeout(function(){localStorage.setItem("databaseSettings",JSON.stringify(b))},500)}),document.getElementById("selectAllBtn").addEventListener("click",ae),document.getElementById("deselectAllBtn").addEventListener("click",ie),document.getElementById("importBtn").addEventListener("click",fe),document.getElementById("addToDbBtn").addEventListener("click",M),document.getElementById("newFolderBtn").addEventListener("click",$),document.getElementById("refreshBtn").addEventListener("click",Y),document.getElementById("closeNewFolderModal").addEventListener("click",X),document.getElementById("cancelNewFolder").addEventListener("click",X),document.getElementById("confirmNewFolder").addEventListener("click",ue),document.getElementById("newFolderName").addEventListener("keypress",function(e){"Enter"===e.key&&ue()}),document.getElementById("contextAddFavorite").addEventListener("click",function(){var e=document.getElementById("contextMenu").dataset.filePath;P.add(e),z(),ee(),ye()}),document.getElementById("contextRemoveFavorite").addEventListener("click",function(){var e=document.getElementById("contextMenu").dataset.filePath;P.delete(e),z(),ee(),ye()}),document.getElementById("contextOpenFolder").addEventListener("click",function(){var e=document.getElementById("contextMenu").dataset.filePath;"folder"!==document.getElementById("contextMenu").dataset.type?e=e.substring(0,e.lastIndexOf("/")):e.includes(b.databasePath)||(e=b.databasePath+"/"+e),openInExplorer(e),ye()}),document.getElementById("contextImportFolder").addEventListener("click",function(){!function(e){pe.apply(this,arguments)}(document.getElementById("contextMenu").dataset.filePath),ye()}),document.getElementById("contextDelete").addEventListener("click",function(){var e=document.getElementById("contextMenu").dataset.filePath;if("folder"===document.getElementById("contextMenu").dataset.type&&e&&!e.includes(b.databasePath)&&(e=b.databasePath+"/"+e),confirm(D("modal.deleteConfirm"))){var t=deletePath(e);t.success?(J(D("status.folderDeleted"),"success"),Y()):J(t.error,"error")}ye()}),document.addEventListener("click",function(e){e.target.closest(".context-menu")||ye()}),b.databasePath&&setTimeout(Y,100),console.log("Data Base extension initialized")})})();